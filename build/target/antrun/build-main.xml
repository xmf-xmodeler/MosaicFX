<?xml version="1.0" encoding="UTF-8" ?>
<project name="maven-antrun-" default="main"  >
<target name="main">
  <target depends="compileMachine,compileXMF,makexmf,makemosaic" name="compile"></target>
  <target depends="init" name="compileMachine">
    <mkdir dir="${machineDir}/bin"/>
    <javac fork="true" destdir="${machineDir}/bin" srcdir="${machineDir}/src">
      <classpath>
        <path>
          <fileset dir="${machineDir}">
            <include name="*.jar"/>
          </fileset>
        </path>
      </classpath>
    </javac>
    <mkdir dir="../bin"/>
    <javac destdir="../bin" srcdir="../src">
      <classpath>
        <path>
          <fileset dir="../lib/">
            <include name="**/*.jar"/>
          </fileset>
          <pathelement location="${machineDir}/bin/"/>
        </path>
      </classpath>
    </javac>
  </target>
  <target depends="init" name="compileXMF">
    <java fork="true" classname="xos.OperatingSystem">
      <jvmarg value="-Duser.country=UK"/>
      <arg value="-image"/>
      <arg value="${imageDir}/compiler.img"/>
      <arg value="-heapSize"/>
      <arg value="5000"/>
      <arg value="-stackSize"/>
      <arg value="50"/>
      <arg value="-arg"/>
      <arg value="filename:${homeDir}/Boot/CompileAll.o"/>
      <arg value="-arg"/>
      <arg value="version:1.0-SNAPSHOT"/>
      <arg value="-arg"/>
      <arg value="user:MichaelBartels"/>
      <arg value="-arg"/>
      <arg value="home:${homeDir}"/>
      <arg value="-arg"/>
      <arg value="license:license.lic"/>
      <classpath>
        <pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
      </classpath>
    </java>
  </target>
  <target depends="init" name="makexmf">
    <java fork="true" classname="xos.OperatingSystem" dir="${homeDir}">
      <jvmarg value="-Duser.country=UK"/>
      <arg value="-port"/>
      <arg value="10101"/>
      <arg value="-initFile"/>
      <arg value="${homeDir}/Boot/Boot.o"/>
      <arg value="-heapSize"/>
      <arg value="5000"/>
      <arg value="-arg"/>
      <arg value="version:1.0-SNAPSHOT"/>
      <arg value="-arg"/>
      <arg value="user:MichaelBartels"/>
      <arg value="-arg"/>
      <arg value="home:${homeDir}"/>
      <arg value="-arg"/>
      <arg value="license:license.lic"/>
      <classpath>
        <pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
      </classpath>
    </java>
  </target>
  <target depends="init" name="makemosaic">
    <java fork="true" classname="xos.OperatingSystem" dir="${homeDir}">
      <jvmarg value="-Duser.country=UK"/>
      <arg value="-port"/>
      <arg value="10101"/>
      <arg value="-image"/>
      <arg value="${imageDir}/xmf.img"/>
      <arg value="-heapSize"/>
      <arg value="10000"/>
      <arg value="-arg"/>
      <arg value="image:${imageDir}/compiler.img"/>
      <arg value="-arg"/>
      <arg value="filename:${homeDir}/Boot/BootMosaic.o"/>
      <arg value="-arg"/>
      <arg value="version:1.0-SNAPSHOT"/>
      <arg value="-arg"/>
      <arg value="user:MichaelBartels"/>
      <arg value="-arg"/>
      <arg value="home:${homeDir}"/>
      <arg value="-arg"/>
      <arg value="saveSource:true"/>
      <arg value="-arg"/>
      <arg value="Comms:true"/>
      <arg value="-arg"/>
      <arg value="Constraints:true"/>
      <arg value="-arg"/>
      <arg value="Java:true"/>
      <arg value="-arg"/>
      <arg value="Format:true"/>
      <arg value="-arg"/>
      <arg value="Env:true"/>
      <arg value="-arg"/>
      <arg value="Arrays:true"/>
      <arg value="-arg"/>
      <arg value="Graphs:true"/>
      <arg value="-arg"/>
      <arg value="Stacks:true"/>
      <arg value="-arg"/>
      <arg value="OCL:true"/>
      <arg value="-arg"/>
      <arg value="Parser:true"/>
      <arg value="-arg"/>
      <arg value="Instrs:true"/>
      <arg value="-arg"/>
      <arg value="Assembler:true"/>
      <arg value="-arg"/>
      <arg value="Signatures:true"/>
      <arg value="-arg"/>
      <arg value="Compiler:true"/>
      <arg value="-arg"/>
      <arg value="Grammar:true"/>
      <arg value="-arg"/>
      <arg value="Extensions:true"/>
      <arg value="-arg"/>
      <arg value="Extensions/Compiler:true"/>
      <arg value="-arg"/>
      <arg value="Undo:true"/>
      <arg value="-arg"/>
      <arg value="Aspects:true"/>
      <arg value="-arg"/>
      <arg value="DocTables:true"/>
      <arg value="-arg"/>
      <arg value="Doc:true"/>
      <arg value="-arg"/>
      <arg value="Eval:true"/>
      <arg value="-arg"/>
      <arg value="XMatch:true"/>
      <arg value="-arg"/>
      <arg value="TopLevel:true"/>
      <arg value="-arg"/>
      <arg value="Walkers:true"/>
      <arg value="-arg"/>
      <arg value="XML:true"/>
      <arg value="-arg"/>
      <arg value="XMap:true"/>
      <arg value="-arg"/>
      <arg value="Manifests:true"/>
      <arg value="-arg"/>
      <arg value="Languages:true"/>
      <arg value="-arg"/>
      <arg value="Associations:true"/>
      <arg value="-arg"/>
      <arg value="Deploy:true"/>
      <arg value="-arg"/>
      <arg value="Debug:true"/>
      <arg value="-arg"/>
      <arg value="XRules:true"/>
      <arg value="-arg"/>
      <arg value="CodeGen:true"/>
      <arg value="-arg"/>
      <arg value="PPrint:true"/>
      <arg value="-arg"/>
      <arg value="Comprehensions:true"/>
      <arg value="-arg"/>
      <arg value="Import:true"/>
      <classpath>
        <pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
      </classpath>
    </java>
  </target>
  <target depends="compile" name="build">
    <delete file="${outputArchive}" failonerror="no"/>
    <copy file="./resources/ini-linux.txt" tofile="./output/ini-linux.txt"/>
    <copy file="./resources/ini-win.txt" tofile="./output/ini-win.txt"/>
    <replace file="./output/ini-linux.txt" value="1.0-SNAPSHOT" token="@@VERSION@@"/>
    <replace file="./output/ini-win.txt" value="1.0-SNAPSHOT" token="@@VERSION@@"/>
    <zip destfile="${outputArchive}" compress="yes" duplicate="fail">
      <zipfileset prefix="${prefix}" dir="..">
        <include name="bin/**"/>
        <include name="lib/*.jar"/>
        <include name="lib/poi-3.10.1/*.jar"/>
        <include name="lib/poi-3.10.1/LICENSE"/>
        <include name="lib/poi-3.10.1/NOTICE"/>
        <include name="setting/**"/>
        <exclude name="**/.DS_Store"/>
        <include name="resources/**"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" dir="./output/">
        <include name="ini-win.txt"/>
        <include name="ini-linux.txt"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" filemode="755" dir="./resources/">
        <include name="*.sh"/>
        <include name="*.bat"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" dir="./resources/">
        <include name="changelog.txt"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" filemode="755" dir="./resources/">
        <include name="XModeler.app/**"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" dir="../../XMF/com.ceteva.xmf.machine">
        <include name="bin/**"/>
        <exclude name="**/.DS_Store"/>
      </zipfileset>
      <zipfileset prefix="${prefix}" dir="../../XMF/com.ceteva.xmf.system">
        <include name="xmf-addons/**"/>
        <include name="xmf-src/**"/>
        <include name="xmf-img/compiler.img"/>
        <include name="xmf-img/xmf.img"/>
        <include name="xmf-img/mosaic.img"/>
        <exclude name="**/.DS_Store"/>
      </zipfileset>
      <zipfileset prefix="${prefix}doc/" dir="../../XMF/com.ceteva.xmf.system/xmf-doc/xmf-books">
        <include name="Bluebook.pdf"/>
      </zipfileset>
      <mappedresources>
        <zipfileset prefix="${prefix}doc/" dir="../../XMF/com.ceteva.xmf.system/xmf-doc/xmf-books/SuperLanguages">
          <include name="book.pdf"/>
        </zipfileset>
        <globmapper from="book.pdf" to="${prefix}doc/Super Languages.pdf"/>
      </mappedresources>
      <zipfileset prefix="${prefix}doc/" dir="../../XMF/com.ceteva.xmf.system/xmf-doc/xmf-books/AppliedMetamodelling">
        <include name="Applied Metamodelling (Second Edition).pdf"/>
      </zipfileset>
    </zip>
    <delete file="./output/ini-win.txt"/>
    <delete file="./output/ini-linux.txt"/>
  </target>
  <target depends="build" name="buildAndRefresh">
    <eclipse.refreshLocal depth="2" resource="MosaicFX/build/output"/>
  </target>
</target>
</project>