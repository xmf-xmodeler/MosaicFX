<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="compileAll" basedir=".">
	<description>
	This buildfile is used for test purposes. If you just need to test some XMF adaptions use this script. 
	There are no activities to pack the project so in comparison to the other scripts this is the fastest.
	Does not contain building a jar and zipping.
	</description>
	<target name="compileAll" depends="compileMachine,compileXMF,makexmf,makemosaic">
	</target>
	<!-- Compile Java code for machine -->
	<target name="compileMachine" depends="init">
		<mkdir dir="${machineDir}/bin"/>
		<javac srcdir="${machineDir}/src" destdir="${machineDir}/bin" fork="true">
			<classpath>
				<path>
					<fileset dir="${machineDir}">
						<include name="*.jar"/>
					</fileset>
				</path>
			</classpath>
		</javac>
		<mkdir dir="../bin"/>
		<javac srcdir="../src" destdir="../bin">
			<classpath>
				<path>
					<fileset dir="../lib/">
						<include name="**/*.jar"/>
					</fileset>
					<pathelement location="${machineDir}/bin/"/>
				</path>
			</classpath>
		</javac>
	</target>
	<!-- Run compileAll for XMF code -->
	<target name="compileXMF" depends="init">
		<java classname="xos.OperatingSystem" fork="true">
			<jvmarg value="-Duser.country=UK"/>
			<arg value="-image"/>
			<arg value="${imageDir}/compiler.img"/>
			<arg value="-heapSize"/>
			<arg value="5000"/>
			<arg value="-stackSize"/>
			<arg value="50"/>
			<arg value="-arg"/>
			<arg value="filename:${homeDir}/Boot/CompileAll.o"/>
			<arg value="-arg"/>
			<arg value="version:${version}"/>
			<arg value="-arg"/>
			<arg value="user:${user.name}"/>
			<arg value="-arg"/>
			<arg value="home:${homeDir}"/>
			<arg value="-arg"/>
			<arg value="license:license.lic"/>
			<classpath>
				<pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
			</classpath>
		</java>
	</target>
	<!-- Run makexmf to build xmf.img -->
	<target name="makexmf" depends="init">
		<java classname="xos.OperatingSystem" fork="true" dir="${homeDir}">
			<jvmarg value="-Duser.country=UK"/>
			<arg value="-port"/>
			<arg value="10101"/>
			<arg value="-initFile"/>
			<arg value="${homeDir}/Boot/Boot.o"/>
			<arg value="-heapSize"/>
			<arg value="5000"/>
			<arg value="-arg"/>
			<arg value="version:${version}"/>
			<arg value="-arg"/>
			<arg value="user:${user.name}"/>
			<arg value="-arg"/>
			<arg value="home:${homeDir}"/>
			<arg value="-arg"/>
			<arg value="license:license.lic"/>
			<classpath>
				<pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
			</classpath>
		</java>
	</target>
	<!-- Run makemosaic to build mosaic.img -->
	<target name="makemosaic" depends="init">
		<java classname="xos.OperatingSystem" fork="true" dir="${homeDir}">
			<jvmarg value="-Duser.country=UK"/>
			<arg value="-port"/>
			<arg value="10101"/>
			<arg value="-image"/>
			<arg value="${imageDir}/xmf.img"/>
			<arg value="-heapSize"/>
			<arg value="10000"/>
			<arg value="-arg"/>
			<arg value="image:${imageDir}/compiler.img"/>
			<arg value="-arg"/>
			<arg value="filename:${homeDir}/Boot/BootMosaic.o"/>
			<arg value="-arg"/>
			<arg value="version:${version}"/>
			<arg value="-arg"/>
			<arg value="user:${user.name}"/>
			<arg value="-arg"/>
			<arg value="home:${homeDir}"/>
			<arg value="-arg"/>
			<arg value="saveSource:true"/>
			<arg value="-arg"/>
			<arg value="Comms:true"/>
			<arg value="-arg"/>
			<arg value="Constraints:true"/>
			<arg value="-arg"/>
			<arg value="Java:true"/>
			<arg value="-arg"/>
			<arg value="Format:true"/>
			<arg value="-arg"/>
			<arg value="Env:true"/>
			<arg value="-arg"/>
			<arg value="Arrays:true"/>
			<arg value="-arg"/>
			<arg value="Graphs:true"/>
			<arg value="-arg"/>
			<arg value="Stacks:true"/>
			<arg value="-arg"/>
			<arg value="OCL:true"/>
			<arg value="-arg"/>
			<arg value="Parser:true"/>
			<arg value="-arg"/>
			<arg value="Instrs:true"/>
			<arg value="-arg"/>
			<arg value="Assembler:true"/>
			<arg value="-arg"/>
			<arg value="Signatures:true"/>
			<arg value="-arg"/>
			<arg value="Compiler:true"/>
			<arg value="-arg"/>
			<arg value="Grammar:true"/>
			<arg value="-arg"/>
			<arg value="Extensions:true"/>
			<arg value="-arg"/>
			<arg value="Extensions/Compiler:true"/>
			<arg value="-arg"/>
			<arg value="Undo:true"/>
			<arg value="-arg"/>
			<arg value="Aspects:true"/>
			<arg value="-arg"/>
			<arg value="DocTables:true"/>
			<arg value="-arg"/>
			<arg value="Doc:true"/>
			<arg value="-arg"/>
			<arg value="Eval:true"/>
			<arg value="-arg"/>
			<arg value="XMatch:true"/>
			<arg value="-arg"/>
			<arg value="TopLevel:true"/>
			<arg value="-arg"/>
			<arg value="Walkers:true"/>
			<arg value="-arg"/>
			<arg value="XML:true"/>
			<arg value="-arg"/>
			<arg value="XMap:true"/>
			<arg value="-arg"/>
			<arg value="Manifests:true"/>
			<arg value="-arg"/>
			<arg value="Languages:true"/>
			<arg value="-arg"/>
			<arg value="Associations:true"/>
			<arg value="-arg"/>
			<arg value="Deploy:true"/>
			<arg value="-arg"/>
			<arg value="Debug:true"/>
			<arg value="-arg"/>
			<arg value="XRules:true"/>
			<arg value="-arg"/>
			<arg value="CodeGen:true"/>
			<arg value="-arg"/>
			<arg value="PPrint:true"/>
			<arg value="-arg"/>
			<arg value="Comprehensions:true"/>
			<arg value="-arg"/>
			<arg value="Import:true"/>
			<classpath>
				<pathelement path="../../XMF/com.ceteva.xmf.machine/bin"/>
			</classpath>
		</java>
	</target>
	<target name="init">
		<property name="homeDir" location="../../XMF/com.ceteva.xmf.system/xmf-src"/>
		<property name="imageDir" location="${homeDir}/../xmf-img/"/>
		<property name="machineDir" location="${homeDir}/../../com.ceteva.xmf.machine/"/>
		<property name="compileAll" location="${homeDir}/bin/compileAll.bat"/>
		<property name="makexmf" location="${homeDir}/bin/makexmf.bat"/>
		<property name="makemosaic" location="${homeDir}/bin/makemosaic.bat"/>
	</target>
</project>
